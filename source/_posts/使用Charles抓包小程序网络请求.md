---
title: 使用Charles抓包小程序网络请求
date: 2021-01-13 22:46:21
tags: [Charles, 小程序抓包, https]
author: 龙虾狂魔
excerpt: https抓包
---

## 抓包https请求

### Charles配置

- Help -> SSL Proxying -> Install Charles Root Certiface，将Charles自带证书安装到`受信任的根证书办法机构`
- Proxy -> SSL Proxying Settings下勾选`Enable SSL Proxying`，并添加需要代理的location：`*:*` `*:443`

### 移动端配置

移动端需要和Charles在同一个局域网中，安装SSL证书；注意部分安卓机型无法安装pem证书，需要修改后缀为crt [参考使用Charles抓包安卓模拟器（MuMu）](https://www.jianshu.com/p/1d0360e50a01)

### 使用夜神Android模拟器

> 现在微信都更新到了7..0以上的版本，使用charles抓包工具已经无法再抓到接口的数据。  
> 原因如下：安卓系统 7.0 以下版本，不管微信任意版本，都会信任系统提供的SSL证书
- 安卓系统 7.0 以上版本，微信 7.0 以下版本，微信会信任系统提供的证书
- 安卓系统 7.0 以上版本，微信 7.0 以上版本，微信只信任它自己配置的证书列表

需要root的手机来将Charles的SSL证书导为系统证书，[参考charles实现微信小程序抓包](https://www.52pojie.cn/thread-1145984-1-1.html)

root手机比较麻烦，可以使用夜神模拟器 [charles实现微信小程序抓包](https://www.52pojie.cn/thread-1145984-1-1.html)

### Charles使用注意事项

Charles是一款很好用的抓包修改工具，但是如果你不是很熟悉这个工具的话，肯定会遇到各种感觉很莫名其妙 的状况，这里就来帮你一一解答。
- 为什么下载了不能用啊？打不开啊。因为charles是需要java环境才能运行的，需要先安装java环境才可以。  
- 为什么我用着用着就自动关闭了？大概30分钟就会关闭一次。因为charles如果没有注册的话，每次打开后就只能哟个30分钟，然后就会自动关闭，所以最好在使用前先按照 说明去进行工具的注册操作。  
- 为什么我在操作的时候有时候就直接工具就界面卡住死了，关都关不掉，只能用任务管理器才可以关掉？这个的确是charles这个工具的一个bug，开始用的时候，我也很恶心，而且经常悲剧，但是现在也有相应的解决 办法了，下面那样操作就可以了。首先随便抓些包，要求有图片的请求。然后选中一个图片的请求，然后分别点击 Response - Raw 然后那里会加载其中的内容，然后加载完毕后，再去 随便操作就可以了，就不会在悲剧的直接工具卡死掉了。。。  
- 为什么用了charles后，我就上不了网页了，但是qq可以。因为如果charles是非正常状态下关闭的话，那么IE的代理就不会被自动取消，所以会导致这种情况。解决办法：第一种：直接打开charles，然后再正常关闭即可。 第二种：去将IE浏览器代理位置的勾选去掉。  
- 为什么我用charles不能抓到socket和https的数据呢？首先，charles是不支持抓去socket数据的。 然后，如果抓不到https的数据的话，请查看你是不是没有勾选ssl 功能。 Proxy - Proxy Settings - SSL 设置  
- 为什么我用charles抓取手机APP，什么都是配置正确的，但是却抓不到数据。首先，请确保电脑的防火墙是关闭状态，这个很重要。如果，防火墙关了还是不行，那么请把手机wifi断掉后重新连接，这样一般就可以解决问题了。 如果以上方法 还是不行的话，那么请将手机wifi位置的ip地址设置成静态ip，然后重启charles工具。  
- 抓包后发现form中有些数据显示是乱码怎么办？请在Raw模式下查看，Raw模式显示的是原始数据包，一般不会因为编码问题导致显示为乱码。  
- 我用charles抓手机app的数据，但是同时也会抓去到电脑端的数据，可以设置吗？可以，设置位置在Proxy - Windows Proxy ，勾选表示接收电脑的数据抓包，如果只想抓去APP的数据请求，可 以不勾选此功能。  
- 为什么我用IE可以抓到数据，但是用360或者谷歌浏览器就不行？请确保360或者谷歌的代码设置中是不是勾选设置的是 使用IE代理。  
- 想要复制粘贴某些数据的话，怎么办，右键没有相应功能啊？请直接使用Ctrl +C 和 Ctrl+V 即可。  